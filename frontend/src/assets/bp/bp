"use strict";var BrowserPonies;"object"!=typeof BrowserPonies&&(function(){function e(e,t){for(var i in t)i in e||(e[i]=t[i])}e(String.prototype,{trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},trimLeft:function(){return this.replace(/^\s\s*/,"")},trimRight:function(){return this.replace(/\s\s*$/,"")}}),e(Array,{isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)}}),e(Array.prototype,{indexOf:function(e,t){for((!t||t<0)&&(t=0);t<this.length;++t)if(this[t]===e)return t;return-1}}),e(Function.prototype,{bind:function(e){var t=this,i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}}}),e(Date,{now:function(){return(new Date).getTime()}}),"undefined"==typeof console&&e(window,{console:{}}),e(window.console,{log:function(){}}),e(window.console,{info:window.console.log,warn:window.console.log,error:window.console.log,trace:window.console.log,dir:window.console.log})}(),BrowserPonies=function(){var c=9e6,l=document.addEventListener?function(e,t,i){e.addEventListener(t,i,!1)}:function(e,t,i){var n="_eventHandlingWrapper"in i?i._eventHandlingWrapper:i._eventHandlingWrapper=function(){var e=window.event;return"stopPropagation"in e||(e.stopPropagation=function(){this.cancelBubble=!0}),"preventDefault"in e||(e.preventDefault=function(){this.returnValue=!1}),"target"in e||(e.target=e.srcElement),i.call(this,e)};e.attachEvent("on"+t,n)},s=document.removeEventListener?function(e,t,i){e.removeEventListener(t,i,!1)}:function(e,t,i){"_eventHandlingWrapper"in i&&e.detachEvent("on"+t,i._eventHandlingWrapper)},e=function(e){null!==ve&&(!function(){for(var e=["hidden","webkitHidden","mozHidden","msHidden"],t=0;t<e.length;++t){var i=e[t];if(i in document)return document[i]}return!1}()?(ee=Date.now(),te()):clearTimeout(ve))};void 0!==document.hidden?l(document,"visibilitychange",e):void 0!==document.webkitHidden?l(document,"webkitvisibilitychange",e):void 0!==document.mozHidden?l(document,"mozvisibilitychange",e):void 0!==document.msHidden&&l(document,"msvisibilitychange",e);function h(e,t,i,n){return e.length>=t?e:(i=new Array(t-e.length+1).join(i),n?i+e:e+i)}function p(e){for(var t="",i=1;e;){var n=/^([^%]*)%(-)?(0)?(\d+)?(?:\.(\d+)?)?([dfesj%])(.*)$/.exec(e);if(!n){t+=e;break}t+=n[1],e=n[7];var r="-"!==n[2],o=n[4]?parseInt(n[4]):0,s=n[5]?parseInt(n[5]):6,a=r&&n[3]||" ";switch(n[6]){case"d":t+=h(parseInt(arguments[i++]).toFixed(0),o,a,r);break;case"f":t+=h(Number(arguments[i++]).toFixed(s),o,a,r);break;case"e":t+=h(Number(arguments[i++]).toExponential(s),o,a,r);break;case"s":t+=h(String(arguments[i++]),o," ",r);break;case"j":t+=h(JSON.stringify(arguments[i++]),o," ",r);break;case"%":t+=h("%",o," ",r)}}return t}function w(e,t){for(var i in t)e[i]=t[i];return e}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}}function f(e){var t=f.abs(e),i=f.FILE_REGEX.exec(t);if(!(i=i||f.NET_REGEX.exec(t)))throw new URIError("Illegal URL: "+e);this.protocol=i[1].toLowerCase(),this.username=i[2],this.password=i[3],this.hostname=i[4],this.port=i[5],this.pathname=i[6]||"/",this.search=i[7]||"",this.hash=i[8]||"",this.port||(this.port=f.DEFAULT_PORTS[this.protocol]),this.port&&f.DEFAULT_PORTS[this.protocol]!==this.port?this.host=this.hostname+":"+this.port:this.host=this.hostname}var _="innerWidth"in window?function(){return{width:window.innerWidth,height:window.innerHeight}}:function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}};f.prototype={toString:function(){return this.protocol+"//"+(this.username||this.password?(this.username||"anonymous")+(this.password?":"+this.password:"")+"@":"")+this.hostname+(this.port&&R4.URL.DEFAULT_PORTS[this.protocol]!==this.port?":"+this.port:"")+this.pathname+this.search+this.hash}},w(f,{FILE_REGEX:/^(file:)\/\/()()()()([^#\?]*)(\?[^#]*)?(#.*)?$/i,NET_REGEX:/^([a-z][-_a-z0-9]*:)\/\/(?:([^:@\/]*)(?::([^:@\/]*))?@)?([^:@\/]*)(?::(\d+))?(?:(\/[^#\?]*)(\?[^#]*)?(#.*)?)?$/i,DEFAULT_PORTS:{"http:":"80","https:":"443","ftp:":"21","ftps:":"990","file:":""},abs:function(e,t){if(t=t||window.location,"//"===e.slice(0,2))return t.protocol+e;if("/"===e[0])return t.protocol+"//"+t.host+e;if("#"===e[0])return t.protocol+"//"+t.host+t.pathname+t.search+e;if("?"===e[0])return t.protocol+"//"+t.host+t.pathname+e;if(/^[a-z][-_a-z0-9]*:/i.test(e))return e;var i=t.pathname.split("/");return i.pop(),0===i.length&&i.push(""),i.push(e),t.protocol+"//"+t.host+i.join("/")},join:function(e){for(var t=0;t<arguments.length;++t){var i=arguments[t];e=/^[a-z][-_a-z0-9]*:/i.test(i)?i:(e=new f(e),"//"===i.slice(0,2)?e.protocol+i:"/"===i[0]?e.protocol+"//"+e.host+i:"#"===i[0]?e.protocol+"//"+e.host+e.pathname+e.search+i:(i[0],e.protocol+"//"+e.host+e.pathname+i))}return f.fix(e)},fix:function(e){return e.replace(/^https?:\/\/web\d?\.student\.tuwien\.ac\.at\/~e0427417\/browser-ponies\//,"https://panzi.github.com/Browser-Ponies/")}});var o,i,t="[object Opera]"===Object.prototype.toString.call(window.opera);!function(){var e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(navigator.userAgent);if(o=!!e){i=e[1].split(".");for(var t=0;t<i.length;++t)i[t]=parseInt(i[t],10)}}();function a(e){for(var t=document.createElement(e),i=1,n=arguments.length;i<n;++i)m(t,arguments[i]);return t}function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e,t){for(var i=0;i<e.length;)e[i]===t?e.splice(i,1):++i}function L(e){var t=e.trim().toLowerCase();if("true"===t)return!0;if("false"===t)return!1;throw new Error("illegal boolean value: "+e)}function z(e){if("string"==typeof e&&(e=e.split(",")),2!==e.length||!/^\s*-?\d+\s*$/.test(e[0])||!/^\s*-?\d+\s*$/.test(e[1]))throw new Error("illegal point value: "+e.join(","));return{x:parseInt(e[0],10),y:parseInt(e[1],10)}}function N(e,t){var i=t.x-e.x,e=t.y-e.y;return Math.sqrt(i*i+e*e)}function M(e){return e[Math.floor(e.length*Math.random())]}function n(e){this.name=e.name,this.probability=e.probability,this.proximity="default"===e.proximity?640:e.proximity,this.activate=e.activate,this.delay=e.delay,this.targets=[],this.behaviors=[];for(var t=0,i=e.behaviors.length;t<i;++t)this.behaviors.push(e.behaviors[t].toLowerCase());for(t=0,i=e.targets.length;t<i;++t){var n=e.targets[t].toLowerCase();if(x(fe,n)){for(var r=fe[n],o=0;o<this.behaviors.length;){var s=this.behaviors[o];x(r.behaviors_by_name,s)?++o:this.behaviors.splice(o,1)}this.targets.push(r)}else console.warn("Interaction "+this.name+" of pony "+e.pony+" references non-existing pony "+n)}}var d=-1<navigator.userAgent.indexOf("Gecko")&&-1===navigator.userAgent.indexOf("KHTML"),g="undefined"!=typeof Audio,m=function(e,t){if(t)if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(Array.isArray(t))for(var i=0,n=t.length;i<n;++i)m(e,t[i]);else if(1===t.nodeType||3===t.nodeType)e.appendChild(t);else for(var r in t){var o=t[r];if("class"===r||"className"===r)e.className=String(o);else if("for"===r||"htmlFor"===r)e.htmlFor=String(o);else if(/^on/.test(r)){if("function"!=typeof o)throw new Error("Event listeners must be a function.");l(e,r.replace(/^on/,""),o)}else if("style"===r)if("object"==typeof o)for(var s in o){var a=o[s];if("float"===s)e.style.cssFloat=a,e.style.styleFloat=a;else if("opacity"===s)v(e,Number(a));else try{e.style[s]=a}catch(e){console.error(s+"="+a+" "+e.toString())}}else e.style.cssText+=";"+o;else"value"===r&&"TEXTAREA"===e.nodeName?e.value=o:!0===o?e.setAttribute(r,r):!1===o?e.removeAttribute(r):e.setAttribute(r,String(o))}},v=o&&i[0]<10?function(e,t){try{e.style.filter=e.style.filter.replace(/\balpha\([^\)]*\)/gi,"")+"alpha(opacity="+100*Number(t)+")"}catch(e){}e.style.opacity=t}:function(e,t){e.style.opacity=t},r={encode:function(e){return btoa(unescape(encodeURIComponent(e)))},decode:function(e){return decodeURIComponent(escape(atob(e)))}},R={parse:function(e){for(var t=e.split(/\r?\n/),i=[],n=0,r=t.length;n<r;++n){var o,s=t[n].trim();0!==s.length&&"'"!==s.charAt(0)&&(o=[],0!==(s=this.parseLine(s,o)).length&&console.error("trailing text:",s),i.push(o))}return i},parseLine:function(e,t){for(var i;0<(e=e.trimLeft()).length;){var n=e.charAt(0);switch(n){case'"':(i=(e=e.slice(1)).search('"'))<0&&(i=e.length),t.push(e.slice(0,i)),0<(e=e.slice(i)).length?('"'===(n=e.charAt(0))&&(n=(e=e.slice(1).trimLeft()).charAt(0)),0<e.length&&(","===n?e=e.slice(1):"}"!==n&&console.error("data after quoted string:",e))):console.error("unterminated quoted string");break;case",":e=e.slice(1),t.push("");break;case"{":var r=[];t.push(r),0<(e=this.parseLine(e.slice(1),r).trimLeft()).length?("}"!==(n=e.charAt(0))?console.error("data after list:",e):n=(e=e.slice(1).trimLeft()).charAt(0),","===n&&(e=e.slice(1))):console.error("unterminated list");break;case"}":case"\n":return e;default:(i=e.search(/[,}]/))<0&&(i=e.length),t.push(e.slice(0,i).trim()),0<(e=e.slice(i)).length&&(","===(n=e.charAt(0))?e=e.slice(1):"}"!==n&&console.error("syntax error:",e))}}return e}},I={Left:0,Right:1,Up:2,Down:3,UpLeft:4,UpRight:5,DownLeft:6,DownRight:7},D={None:0,HorizontalOnly:1,VerticalOnly:2,HorizontalVertical:3,DiagonalOnly:4,DiagonalHorizontal:5,DiagonalVertical:6,All:7,MouseOver:8,Sleep:9,Dragged:10},b={Top:0,Bottom:1,Left:2,Right:3,BottomRight:4,BottomLeft:5,TopRight:6,TopLeft:7,Center:8,Any:9,AnyNotCenter:10},P={wav:"audio/wav",webm:"audio/webm",mpeg:"audio/mpeg",mpga:"audio/mpeg",mpg:"audio/mpeg",mp1:'audio/mpeg;codecs="mp1"',mp2:'audio/mpeg;codecs="mp2"',mp3:'audio/mpeg;codecs="mp3"',mp4:"audio/mp4",mp4a:"audio/mp4",ogg:"audio/ogg",oga:"audio/ogg",flac:'audio/ogg;codecs="flac"',spx:'audio/ogg;codecs="speex"'};n.prototype={reachableTargets:function(e){var t=[],i=this.targets.length;if(0===i)return t;for(var n=0;n<i;++n){for(var r=this.targets[n],o=null,s=1/0,a=0,h=r.instances.length;a<h;++a){var l=r.instances[a],c=N(e,l.position());c<=this.proximity&&c<s&&(o=l,s=c)}if(o)t.push([s,o]);else if("all"===this.activate)return null}if(0===t.length)return null;if("one"===this.activate)return t.sort(function(e,t){return e[0]-t[0]}),[t[0][1]];for(n=0;n<t.length;++n)t[n]=t[n][1];return t}};function y(e,t){if(w(this,t),!this.name||"none"===this.name.toLowerCase())throw new Error(e+": illegal behavior name "+this.name);this.follow&&(this.follow=this.follow.toLowerCase()),this.movement=null;var i,n=t.movement.replace(/[-_\s]/g,"").toLowerCase();for(i in D)if(i.toLowerCase()===n){this.movement=D[i];break}if(null===this.movement)throw new Error(e+": illegal movement "+t.movement+" for behavior "+t.name);if(this.rightsize={width:0,height:0},t.rightimage&&(this.rightimage=f.join(e,t.rightimage)),this.leftsize={width:0,height:0},t.leftimage&&(this.leftimage=f.join(e,t.leftimage)),this.rightcenter&&(0!==this.rightcenter.x||0!==this.rightcenter.y)||(this.rightcenter={x:0,y:0,missing:!0}),this.leftcenter&&(0!==this.leftcenter.x||0!==this.leftcenter.y)||(this.leftcenter={x:0,y:0,missing:!0}),this.effects=[],this.effects_by_name={},"effects"in t)for(var r=0,o=t.effects.length;r<o;++r){var s=new A(e,t.effects[r]);this.effects_by_name[s.name.toLowerCase()]=s,this.effects.push(s)}}y.prototype={deref:function(e,t){var i=this[e],n=(i||"").toLowerCase();i&&"none"!==n?x(t.behaviors_by_name,n)?this[e]=t.behaviors_by_name[n]:(console.warn(p("%s: Behavior %s of pony %s references non-existing behavior %s.",t.baseurl,this.name,t.name,i)),delete this[e]):delete this[e]},preload:function(){for(var e=0,t=this.effects.length;e<t;++e)this.effects[e].preload();this.rightimage&&H(this.rightimage,function(e){this.rightsize.width=e.width,this.rightsize.height=e.height,this.rightcenter.missing&&(this.rightcenter={x:Math.round(.5*e.width),y:Math.round(.5*e.height)})}.bind(this)),this.leftimage&&H(this.leftimage,function(e){this.leftsize.width=e.width,this.leftsize.height=e.height,this.leftcenter.missing&&(this.leftcenter={x:Math.round(.5*e.width),y:Math.round(.5*e.height)})}.bind(this))},isMoving:function(){if(this.follow||this.x||this.x)return!0;switch(this.movement){case D.None:case D.MouseOver:case D.Sleep:return!1;default:return!0}}};var A=function(e,t){w(this,t),this.name=t.name.toLowerCase();for(var i=["rightloc","leftloc","rightcenter","leftcenter"],n=0;n<i.length;++n){var r=i[n];r in t&&(this[r]=function(e){var t,i=e.replace(/[-_\s]/g,"").toLowerCase();for(t in b)if(t.toLowerCase()===i)return b[t];throw new Error("illegal location: "+e)}(t[r]))}this.rightsize={width:0,height:0},t.rightimage&&(this.rightimage=f.join(e,t.rightimage)),this.rightcenter_point={x:0,y:0},this.leftsize={width:0,height:0},t.leftimage&&(this.leftimage=f.join(e,t.leftimage)),this.leftcenter_point={x:0,y:0}};A.prototype={preload:function(){this.rightimage&&H(this.rightimage,function(e){this.rightsize.width=e.width,this.rightsize.height=e.height,this.rightcenter_point={x:Math.round(.5*e.width),y:Math.round(.5*e.height)}}.bind(this)),this.leftimage&&H(this.leftimage,function(e){this.leftsize.width=e.width,this.leftsize.height=e.height,this.leftcenter_point={x:Math.round(.5*e.width),y:Math.round(.5*e.height)}}.bind(this))}};function C(e,t,i){e=e.object=new Image,l(e,"load",u(i,!0)),l(e,"error",u(i,!1)),l(e,"abort",u(i,!1)),e.src=t}function S(e){var t=new Audio;if("string"==typeof e)t.src=e;else for(var i in e){var n=a("source",{src:e[i]});"audio/x-unknown"!==i&&(n.type=i),t.appendChild(n)}return t}function B(e,t){var i,n;if("string"==typeof e)i=e;else{var r,o=[];for(r in e)o.push(e[r]);if(0===o.length)throw new Error("no audio url to preload");if(1===o.length)i=o[0];else{for(var s=o[0],a=1;a<o.length;++a){var h=function(e,t){for(var i=Math.min(e.length,t.length),n=0;n<i;++n)if(e.charAt(n)!==t.charAt(n))return n;return i}(s,o[a]);h!==s.length&&(s=s.slice(0,h))}for(a=0;a<o.length;++a)o[a]=o[a].slice(s.length);o.sort(),i=s+"{"+o.join("|")+"}"}}j((n=e,function(e,t,i){e=e.object=S(n);l(e,"loadeddata",u(i,!0)),l(e,"error",u(i,!1)),l(e,"abort",u(i,!1)),e.preload="auto"}),i,t)}var T={},E=0,U=0,O=[],F=[],H=function(e,t){j(C,e,t)},j=function(e,n,t){var r;x(T,n)?t&&((r=T[n]).loaded?t(r.object):r.callbacks.push(t)):(++E,e(r=T[n]={loaded:!1,callbacks:t?[t]:[]},n,function(e){if(r.loaded)console.error("resource loaded twice: "+n);else{r.loaded=!0,++U,e?console.log(p("%3.0f%% %d of %d loaded: %s",100*U/E,U,E,n)):console.error(p("%3.0f%% %d of %d load error: %s",100*U/E,U,E,n));for(var t=0,i=F.length;t<i;++t)F[t](U,E,n,e);for(t=0,i=r.callbacks.length;t<i;++t)r.callbacks[t](r.object,e);if(delete r.callbacks,U===E){for(t=0,i=O.length;t<i;++t)O[t]();O=[]}}}))};j(function(e,t,i){var n,r,o;document.body?i(!0):(n=!1,r=function(){n||i(n=!0)},document.addEventListener?l(document,"DOMContentLoaded",r):(o=function(){"complete"===document.readyState&&(s(document,"readystatechange",o),r())},l(document,"readystatechange",o)),l(window,"load",r))},document.location.href);function V(e){U===E?e():O.push(e)}function W(e){F.push(e)}var q=0,X=null,$=function(){q=U,document.body.appendChild(X.container),G(),setTimeout(function(){X&&!X.finished&&(X.container.style.display="")},250),l(window,"resize",G),s(window,"load",$)},G=function(){var e=_(),t=!1;"none"===X.container.style.display&&(t=!0,X.container.style.visibility="hidden",X.container.style.display="");var i=X.container.offsetWidth,n=X.container.offsetHeight,r=X.label.offsetHeight;t&&(X.container.style.display="none",X.container.style.visibility=""),X.container.style.left=Math.round(.5*(e.width-i))+"px",X.container.style.top=Math.round(.5*(e.height-n))+"px",X.label.style.top=Math.round(.5*(n-r))+"px"};W(function(e,t,i){(re||X)&&(X||((X={bar:a("div",{style:{margin:"0",padding:"0",borderStyle:"none",width:"0",height:"100%",background:"#9BD6F4",MozBorderRadius:"5px",borderRadius:"5px"}}),label:a("div",{style:{position:"absolute",margin:"0",padding:"0",borderStyle:"none",top:"0px",left:"0px",width:"100%",textAlign:"center"}})}).barcontainer=a("div",{style:{margin:"0",padding:"0",borderStyle:"none",width:"100%",height:"100%",background:"#D8D8D8",MozBorderRadius:"5px",borderRadius:"5px"}},X.bar),X.container=a("div",{style:{position:"fixed",width:"450px",height:"30px",background:"white",padding:"10px",margin:"0",MozBorderRadius:"5px",borderRadius:"5px",color:"#294256",fontWeight:"bold",fontSize:"16px",opacity:"0.9",display:"none",boxShadow:"2px 2px 12px rgba(0,0,0,0.4)",MozBoxShadow:"2px 2px 12px rgba(0,0,0,0.4)"},onclick:function(){X&&(X.container.style.display="none")}},X.barcontainer,X.label)),"none"===X.container.style.display&&(q=e),X.finished=e===t,t=0==(t=t-q)?1:(e-q)/t,X.bar.style.width=Math.round(450*t)+"px",X.label.innerHTML=p("Loading Ponies&hellip; %d%%",Math.floor(100*t)),X.container.parentNode||(document.body?$():l(window,"load",$)),X.finished&&setTimeout(function(){s(window,"resize",G),s(window,"load",$),X&&X.container&&X.container.parentNode&&X.container.parentNode.removeChild(X.container),X=null},500))});function K(e){if(this.baseurl=f.join(ae,e.baseurl||""),!e.name)throw new Error("pony with following base URL has no name: "+this.baseurl);if(this.name=e.name,this.behaviorgroups=e.behaviorgroups||{},this.all_behaviors=[],this.random_behaviors=[],this.mouseover_behaviors=[],this.dragged_behaviors=[],this.stand_behaviors=[],this.behaviors_by_name={},this.speeches=[],this.random_speeches=[],this.speeches_by_name={},this.interactions=[],this.instances=[],this.categories=[],e.categories)for(var t=0,i=e.categories.length;t<i;++t)this.categories.push(e.categories[t].toLowerCase());if(e.speeches)for(t=0,i=e.speeches.length;t<i;++t){var n=w({},e.speeches[t]);if(n.files){var r,o=0;for(r in n.files)n.files[r]=f.join(this.baseurl,n.files[r]),++o;0===o&&delete n.files}n.name&&(a=n.name.toLowerCase(),x(this.speeches_by_name,a)?console.warn(p("%s: Speech name %s of pony %s is not unique.",this.baseurl,n.name,e.name)):this.speeches_by_name[a]=n),"skip"in n||(n.skip=!1),n.skip||this.random_speeches.push(n),"group"in n?0===n.group||x(this.behaviorgroups,n.group)||console.warn(p("%s: Speech %s references unknown behavior group %d.",this.baseurl,n.name,n.group)):n.group=0,this.speeches.push(n)}var s=["speakstart","speakend"];if("behaviors"in e){for(t=0,i=e.behaviors.length;t<i;++t){var a=(u=new y(this.baseurl,e.behaviors[t])).name.toLowerCase();x(this.behaviors_by_name,a)?console.warn(p("%s: Behavior name %s of pony %s is not unique.",this.baseurl,u.name,e.name)):this.behaviors_by_name[a]=u;for(var h=0;h<s.length;++h){var l=s[h],c=u[l];c&&(c=c.toLowerCase(),x(this.speeches_by_name,c)?u[l]=this.speeches_by_name[c]:(console.warn(p("%s: Behavior %s of pony %s references non-existing speech %s.",this.baseurl,u.name,e.name,u[l])),delete u[l]))}switch(this.all_behaviors.push(u),"skip"in u||(u.skip=!1),u.skip||this.random_behaviors.push(u),u.movement){case D.MouseOver:this.mouseover_behaviors.push(u),u.skip||this.stand_behaviors.push(u);break;case D.Dragged:this.dragged_behaviors.push(u),u.skip||this.stand_behaviors.push(u);break;case D.None:u.skip||this.stand_behaviors.push(u)}"group"in u?0===u.group||x(this.behaviorgroups,u.group)||console.warn(p("%s: Behavior %s references unknown behavior group %d.",this.baseurl,u.name,u.group)):u.group=0}if(0===this.dragged_behaviors.length&&0<this.mouseover_behaviors.length&&(this.dragged_behaviors=this.mouseover_behaviors.slice()),0===this.stand_behaviors.length)for(t=0,i=this.all_behaviors.length;t<i;++t)(u=this.all_behaviors[t]).movement!==D.Sleep||u.skip||this.stand_behaviors.push(u);0===this.stand_behaviors.length?console.warn(p("%s: Pony %s has no (non-skip) non-moving behavior.",this.baseurl,this.name)):0===this.mouseover_behaviors.length&&(this.mouseover_behaviors=this.stand_behaviors.slice());for(var u,t=0,i=this.all_behaviors.length;t<i;++t)(u=this.all_behaviors[t]).deref("linked",this),u.deref("stopped",this),u.deref("moving",this)}}K.prototype={preload:function(){for(var e=0,t=this.all_behaviors.length;e<t;++e)this.all_behaviors[e].preload();if(g&&oe)for(e=0,t=this.speeches.length;e<t;++e){var i=this.speeches[e];i.files&&B(i.files)}},unspawnAll:function(){for(;0<this.instances.length;)this.instances[0].unspawn()},addInteraction:function(e){if(0===(e=new n(e)).targets.length)return console.warn("Dropping interaction "+e.name+" of pony "+this.name+" because it has no targets."),!1;for(var t=0;t<e.behaviors.length;){var i=e.behaviors[t];x(this.behaviors_by_name,i)?++t:e.behaviors.splice(t,1)}return 0===e.behaviors.length?(console.warn("Dropping interaction "+e.name+" of pony "+this.name+" because it has no common behaviors."),!1):(this.interactions.push(e),!0)}};function Y(e){var t=_(),i=e.x,n=e.y,r=.5*e.width,e=.5*e.height;return i<r?i=r:i+r>t.width&&(i=t.width-r),n<e?n=e:n+e>t.height&&(n=t.height-e),{x:Math.round(i),y:Math.round(n)}}var J=function(e,t){var i=.5*e.width,n=.5*e.height;return e.x<i||e.y<n||e.x+i>t.width||e.y+n>t.height},e=function(){};e.prototype={setTopLeftPosition:function(e){this.current_position.x=e.x+this.current_center.x,this.current_position.y=e.y+this.current_center.y,this.img.style.left=Math.round(e.x)+"px",this.img.style.top=Math.round(e.y)+"px";e=Math.round(c+e.y+this.current_size.height);this.zIndex!==e&&(this.img.style.zIndex=e)},setPosition:function(e){var t=this.current_position.x=e.x,e=this.current_position.y=e.y,e=Math.round(e-this.current_center.y);this.img.style.left=Math.round(t-this.current_center.x)+"px",this.img.style.top=e+"px";e=Math.round(c+e+this.current_size.height);this.zIndex!==e&&(this.img.style.zIndex=e)},moveBy:function(e){this.setPosition({x:this.current_position.x+e.x,y:this.current_position.y+e.y})},clipToScreen:function(){this.setPosition(Y(this.rect()))},topLeftPosition:function(){return{x:this.current_position.x-this.current_center.x,y:this.current_position.y-this.current_center.y}},position:function(){return this.current_position},size:function(){return this.current_size},rect:function(){var e=this.current_position;return e.width=this.current_size.width,e.height=this.current_size.height,e},topLeftRect:function(){var e=this.topLeftPosition(),t=this.size();return{x:e.x,y:e.y,width:t.width,height:t.height}},isOffscreen:function(){return e=this.rect(),J(e,_());var e}};function Z(e){this.pony=e,this.img=this.createImage(),this.clear()}Z.prototype=w(new e,{createImage:function(){function e(e){if(e.preventDefault(),!(1<e.touches.length||"touchend"===e.type&&0<e.touches.length)){var t=document.createEvent("MouseEvents"),i=null,n=null;switch(e.type){case"touchstart":i="mousedown",n=e.changedTouches[0];break;case"touchmove":i="mousemove",n=e.changedTouches[0];break;case"touchend":i="mouseup",n=e.changedTouches[0]}t.initMouseEvent(i,!0,!0,e.target.ownerDocument.defaultView,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),e.target.dispatchEvent(t)}}return a("img",{draggable:"false",style:{position:"fixed",userSelect:"none",borderStyle:"none",margin:"0",padding:"0",backgroundColor:"transparent",zIndex:String(c)},ondragstart:function(e){e.preventDefault()},ontouchstart:e,ontouchmove:e,ontouchend:e,ondblclick:function(){var e=this.position(),t=(this.end_time-this.start_time)/1e3;console.log(p("%s does %s%s for %.2f seconds, is at %d x %d and %s. See:",this.pony.name,this.current_behavior.name,this.current_behavior===this.paint_behavior?"":" using "+this.paint_behavior.name,t,e.x,e.y,this.following?"follows "+this.following.name():p("wants to go to %d x %d",this.dest_position.x,this.dest_position.y)),this)}.bind(this),onmousedown:function(e){("buttons"in e?1&e.buttons:o?1&e.button:0===e.button)&&((ye=this).mouseover=!0,null!==ve&&this.nextBehavior(!0),e.preventDefault())}.bind(this),onmouseover:function(){this.mouseover||(this.mouseover=!0,null===ve||this.isMouseOverOrDragging()||!this.canMouseOver()&&!this.canDrag()||this.nextBehavior(!0))}.bind(this),onmouseout:function(e){e.target;this.mouseover&&(this.mouseover=!1)}.bind(this)})},isMouseOverOrDragging:function(){return this.current_behavior&&(this.current_behavior.movement===D.MouseOver||this.current_behavior.movement===D.Dragged)},canDrag:function(){if(this.current_behavior){for(var e=this.current_behavior.group,t=0,i=this.pony.dragged_behaviors.length;t<i;++t){var n=this.pony.dragged_behaviors[t];if(0===n.group||n.group===e)return!0}return!1}return 0<this.pony.dragged_behaviors.length},canMouseOver:function(){if(this.current_behavior){for(var e=this.current_behavior.group,t=0,i=this.pony.mouseover_behaviors.length;t<i;++t){var n=this.pony.mouseover_behaviors[t];if(0===n.group||n.group===e)return!0}return!1}return 0<this.pony.mouseover_behaviors.length},name:function(){return this.pony.name},unspawn:function(){var e=Date.now();if(this.effects)for(var t=0,i=this.effects.length;t<i;++t)ge.push({at:e,element:this.effects[t].img});ge.push({at:e,element:this.img}),k(this.pony.instances,this),k(de,this)},clear:function(){if(this.effects)for(var e=0,t=this.effects.length;e<t;++e)this.effects[e].clear();this.img.parentNode&&this.img.parentNode.removeChild(this.img),this.mouseover=!1,this.start_time=null,this.end_time=null,this.current_interaction=null,this.interaction_targets=null,this.current_imgurl=null,this.interaction_wait=0,this.current_position={x:0,y:0},this.dest_position={x:0,y:0},this.current_size={width:0,height:0},this.current_center={x:0,y:0},this.zIndex=c,this.current_behavior=null,this.paint_behavior=null,this.facing_right=!0,this.end_at_dest=!1,this.effects=[],this.repeating=[]},interact:function(e,t,i){var n,r=M(t.behaviors);this.behave(this.pony.behaviors_by_name[r]);for(var o=0,s=i.length;o<s;++o)(n=i[o]).behave(n.pony.behaviors_by_name[r]),n.current_interaction=t;this.current_interaction=t,this.interaction_targets=i},speak:function(e,t){var i,n,r;ce||(t.text&&(i={at:e+Math.max(150*t.text.length,1e3)},n=a("div",{ondblclick:function(){i.at=Date.now()},style:{fontSize:"14px",color:"#294256",background:o?"white":"rgba(255,255,255,0.8)",position:"fixed",visibility:"hidden",margin:"0",padding:"4px",maxWidth:"250px",textAlign:"center",borderRadius:"10px",MozBorderRadius:"10px",width:"auto",height:"auto",boxShadow:"2px 2px 12px rgba(0,0,0,0.4)",MozBoxShadow:"2px 2px 12px rgba(0,0,0,0.4)",zIndex:String(9e3+c)}},t.text),i.element=n,r=this.topLeftRect(),xe().appendChild(n),e=Math.round(r.x+.5*r.width-.5*n.offsetWidth),r=r.y+r.height,n.style.left=e+"px",n.style.top=r+"px",n.style.visibility="",ge.push(i),n=null),g&&oe&&t.files&&((t=S(t.files)).volume=_e,t.play()))},update:function(e,t,i){var n,r=this.rect(),o=null;this.following?this.following.img.parentNode?((o=this.dest_position).x=this.following.current_position.x,this.following.facing_right?o.x+=this.current_behavior.x-this.following.paint_behavior.rightcenter.x:o.x+=-this.current_behavior.x+this.following.paint_behavior.leftcenter.x,o.y=this.following.current_position.y+this.current_behavior.y,c=N(r,o),!this.current_behavior.x&&!this.current_behavior.y&&c<=.5*r.width&&(o=null)):this.following=null:(o=this.dest_position)&&(c=N(r,o)),o?(u=o.x-r.x,f=o.y-r.y,(n=c<=(d=this.current_behavior.speed*t*.01*he)?o:(p=d/c,{x:Math.round(r.x+p*u),y:Math.round(r.y+p*f)})).x!==o.x?this.setFacingRight(n.x<=o.x):this.following&&(this.current_behavior.auto_select_images||(0===Math.round(d)?this.current_behavior.stopped&&(this.paint_behavior=this.current_behavior.stopped):this.current_behavior.moving&&(this.paint_behavior=this.current_behavior.moving)),this.setFacingRight(this.following.facing_right)),this.setPosition(n)):n=r;for(var s=0;s<this.effects.length;){var a=this.effects[s];a.update(e,t,i)?++s:(this.effects.splice(s,1),ge.push({element:a.img,at:e}))}for(var h,l,c,u,p,f,d,s=0,g=this.repeating.length;s<g;++s){var m,v=this.repeating[s];v.at<=e&&(m=new Q(this,e,v.effect),me.appendChild(m.img),m.updatePosition(e,0),this.effects.push(m),v.at+=1e3*v.effect.delay)}if(this.interaction_wait<=e&&0<this.pony.interactions.length&&!this.current_interaction){for(var b=0,y=[],w=null,s=0,g=this.pony.interactions.length;s<g;++s){var _=(w=this.pony.interactions[s]).reachableTargets(r);_&&(b+=w.probability,y.push([w,_]))}if(0<y.length){for(var x=Math.random()*b,k=0,s=0,g=y.length;s<g&&!(x<=(k+=(w=y[s]).probability));++s);if((x=Math.random()*(100/pe))<=w[0].probability)return void this.interact(e,w[0],w[1])}this.interaction_wait+=pe}e>=this.end_time||this.end_at_dest&&this.dest_position.x===n.x&&this.dest_position.y===n.y?this.nextBehavior():this.following||(h=this.current_center.x,l=this.current_center.y,c=this.current_size.width-h,u=this.current_size.height-l,p=n.x-h,f=n.x+c,o=n.y-l,d=n.y+u,p<=0?this.dest_position.x<n.x&&(this.dest_position.x=Math.round(Math.max(n.x+n.x-this.dest_position.x,h))):f>=i.width&&this.dest_position.x>n.x&&(this.dest_position.x=Math.round(Math.min(n.x+n.x-this.dest_position.x,i.width-c))),o<=0?this.dest_position.y<n.y&&(this.dest_position.y=Math.round(Math.max(n.y+n.y-this.dest_position.y,l))):d>=i.height&&this.dest_position.y>n.y&&(this.dest_position.y=Math.round(Math.min(n.y+n.y-this.dest_position.y,i.height-u))))},getNearestInstance:function(e){var t=[],i=this.position(),n=fe[e];if(n)for(r=0,o=n.instances.length;r<o;++r){s=n.instances[r];this.loops(s)||t.push([N(i,s.position()),s])}else for(var r=0,o=de.length;r<o;++r){var s=de[r];if(!this.loops(s))for(var a=0,h=s.effects.length;a<h;++a){var l=s.effects[a];l.effect.name===e&&t.push([N(i,l.position()),l])}}return 0===t.length?null:(t.sort(function(e,t){return e[0]-t[0]}),t[0][1])},nextBehavior:function(e){var t=this.isOffscreen();if(!e&&this.current_behavior&&this.current_behavior.linked)this.behave(this.current_behavior.linked,t);else{if(this.current_interaction){e=Date.now();if(this.interaction_wait=e+1e3*this.current_interaction.delay,this.interaction_targets){for(var i=0,n=this.interaction_targets.length;i<n;++i)this.interaction_targets[i].interaction_wait=this.interaction_wait;this.interaction_targets=null}this.current_interaction=null}this.behave(this.randomBehavior(t),t)}},setFacingRight:d?function(e){var t;(this.facing_right=e)?(t=this.paint_behavior.rightimage,this.current_size=this.paint_behavior.rightsize,this.current_center=this.paint_behavior.rightcenter):(t=this.paint_behavior.leftimage,this.current_size=this.paint_behavior.leftsize,this.current_center=this.paint_behavior.leftcenter),t!==this.current_imgurl&&((e=this.createImage()).style.left=this.img.style.left,e.style.top=this.img.style.top,e.style.zIndex=this.img.style.zIndex,e.src=this.current_imgurl=t,this.img.parentNode.replaceChild(e,this.img),this.img=e)}:function(e){var t;(this.facing_right=e)?(t=this.paint_behavior.rightimage,this.current_size=this.paint_behavior.rightsize,this.current_center=this.paint_behavior.rightcenter):(t=this.paint_behavior.leftimage,this.current_size=this.paint_behavior.leftsize,this.current_center=this.paint_behavior.leftcenter),t!==this.current_imgurl&&(this.img.src=this.current_imgurl=t)},behave:function(e,t){this.start_time=Date.now();var i=e.minduration+(e.maxduration-e.minduration)*Math.random();this.end_time=this.start_time+1e3*i;var n=this.current_behavior;this.current_behavior=this.paint_behavior=e;for(var r=[],o=0,s=this.effects.length;o<s;++o)(y=this.effects[o]).effect.duration?r.push(y):ge.push({element:y.img,at:this.start_time});this.facing_right?(this.current_size=this.paint_behavior.rightsize,this.current_center=this.paint_behavior.rightcenter):(this.current_size=this.paint_behavior.leftsize,this.current_center=this.paint_behavior.leftcenter);var a=!1;n&&n.speakend&&(this.speak(this.start_time,n.speakend),a=!0),this.following=null,e.follow&&(this.following=this.getNearestInstance(e.follow)),e.speakstart?this.speak(this.start_time,e.speakstart):a||this.following||this.current_interaction||this.speakRandom(this.start_time,le);var h=this.position(),l=this.size(),c=_();if(this.end_at_dest=!1,this.following)this.dest_position.x=this.following.current_position.x,this.dest_position.y=this.following.current_position.y;else if(e.follow||!e.x&&!e.y){var u=null;switch(e.movement){case D.HorizontalOnly:u=[I.Left,I.Right];break;case D.VerticalOnly:u=[I.Up,I.Down];break;case D.HorizontalVertical:u=[I.Left,I.Right,I.Up,I.Down];break;case D.DiagonalOnly:u=[I.UpLeft,I.UpRight,I.DownLeft,I.DownRight];break;case D.DiagonalHorizontal:u=[I.Left,I.Right,I.UpLeft,I.UpRight,I.DownLeft,I.DownRight];break;case D.DiagonalVertical:u=[I.Up,I.Down,I.UpLeft,I.UpRight,I.DownLeft,I.DownRight];break;case D.All:u=[I.Left,I.Right,I.Up,I.Down,I.UpLeft,I.UpRight,I.DownLeft,I.DownRight]}if(null===u)this.dest_position.x=Math.round(h.x),this.dest_position.y=Math.round(h.y);else{var p=h.y-.5*l.height<100,f=h.y+.5*l.height+100>c.height,d=h.x-.5*l.width<100,n=h.x+.5*l.width+100>c.width,a=u.slice();p&&(k(a,I.Up),k(a,I.UpLeft),k(a,I.UpRight)),f&&(k(a,I.Down),k(a,I.DownLeft),k(a,I.DownRight)),d&&(k(a,I.Left),k(a,I.UpLeft),k(a,I.DownLeft)),n&&(k(a,I.Right),k(a,I.UpRight),k(a,I.DownRight));var g,m=e.speed*i*100*he;switch(M(0===a.length?u:a)){case I.Up:this.dest_position={x:h.x,y:h.y-m};break;case I.Down:this.dest_position={x:h.x,y:h.y+m};break;case I.Left:this.dest_position={x:h.x-m,y:h.y};break;case I.Right:this.dest_position={x:h.x+m,y:h.y};break;case I.UpLeft:g=Math.sqrt(m*m*.5),this.dest_position={x:h.x-g,y:h.y-g};break;case I.UpRight:g=Math.sqrt(m*m*.5),this.dest_position={x:h.x+g,y:h.y-g};break;case I.DownLeft:g=Math.sqrt(m*m*.5),this.dest_position={x:h.x-g,y:h.y+g};break;case I.DownRight:g=Math.sqrt(m*m*.5),this.dest_position={x:h.x+g,y:h.y+g}}t?(this.dest_position=Y(w(this.dest_position,l)),this.end_at_dest=!0):(this.dest_position.x=Math.round(this.dest_position.x),this.dest_position.y=Math.round(this.dest_position.y))}}else this.end_at_dest=!0,this.dest_position={x:Math.round((c.width-l.width)*(e.x||0)/100),y:Math.round((c.height-l.height)*(e.y||0)/100)};this.setFacingRight(h.x!==this.dest_position.x?h.x<=this.dest_position.x:this.facing_right),this.setPosition(this.current_position);var v=xe();this.repeating=[];for(o=0,s=e.effects.length;o<s;++o){var b=e.effects[o],y=new Q(this,this.start_time,b);v.appendChild(y.img),y.updatePosition(this.start_time,0),r.push(y),b.delay&&this.repeating.push({effect:b,at:this.start_time+1e3*b.delay})}this.effects=r},teleport:function(){var e=_(),t=this.size();this.setTopLeftPosition({x:Math.random()*(e.width-t.width),y:Math.random()*(e.height-t.height)})},speakRandom:function(e,t){if(!(Math.random()>=t)){for(var i=[],n=this.current_behavior.group,r=0,o=this.pony.random_speeches.length;r<o;++r){var s=this.pony.random_speeches[r];0!==s.group&&s.group!==n||i.push(s)}0<i.length&&this.speak(e,M(i))}},randomBehavior:function(e){for(var t=this.current_behavior?this.current_behavior.group:0,i=this===ye&&this.canDrag()?this.pony.dragged_behaviors:this.mouseover&&this.canMouseOver()?this.pony.mouseover_behaviors:this.pony.random_behaviors,n=0,r=[],o=0,s=i.length;o<s;++o){var a=i[o];e&&!a.isMoving()||0!==t&&0!==a.group&&a.group!==t||(n+=a.probability,r.push(a))}for(var h=Math.random()*n,l=0,o=0,s=r.length;o<s;++o)if(h<=(l+=(a=r[o]).probability))return a;return e?this.randomBehavior(!1):null},loops:function(e){for(;e;){if(this===e)return!0;e=e.following}return!1}});var Q=function(e,t,i){this.pony=e,this.start_time=t;var n,r=1e3*i.duration;d&&(r*=.6),r=Math.max(r-ie,ie),this.end_time=t+r,this.effect=i,e.facing_right?(n=this.effect.rightimage,this.current_size=this.effect.rightsize,this.current_center=this.effect.rightcenter_point):(n=this.effect.leftimage,this.current_size=this.effect.leftsize,this.current_center=this.effect.leftcenter_point),this.current_position={x:0,y:0},this.zIndex=c,this.current_imgurl=null,this.img=this.createImage(n);for(var o=["rightloc","rightcenter","leftloc","leftcenter"],s=0,a=o.length;s<a;++s){var h=o[s],l=i[h];l===b.Any?l=M([b.Top,b.Bottom,b.Left,b.Right,b.BottomRight,b.BottomLeft,b.TopRight,b.TopLeft,b.Center]):l===b.AnyNotCenter&&(l=M([b.Top,b.Bottom,b.Left,b.Right,b.BottomRight,b.BottomLeft,b.TopRight,b.TopLeft])),this[h]=l}};Q.prototype=w(new e,{createImage:function(e){e=a(d||t?"img":"iframe",{src:e,draggable:"false",style:{position:"fixed",overflow:"hidden",userSelect:"none",pointerEvents:"none",borderStyle:"none",margin:"0",padding:"0",backgroundColor:"transparent",width:this.current_size.width+"px",height:this.current_size.height+"px",zIndex:String(c)}});return o&&(e.setAttribute("scrolling","no"),e.setAttribute("frameborder","0"),e.setAttribute("marginheight","0"),e.setAttribute("marginwidth","0")),e},name:function(){return this.effect.name},clear:function(){this.img.parentNode&&this.img.parentNode.removeChild(this.img)},updatePosition:function(e,t){var i,n,r=this.pony.facing_right?(i=this.rightloc,this.rightcenter):(i=this.leftloc,this.leftcenter),o=this.size();switch(r){case b.Top:n={x:.5*-o.width,y:0};break;case b.Bottom:n={x:.5*-o.width,y:-o.height};break;case b.Left:n={x:0,y:.5*-o.height};break;case b.Right:n={x:-o.width,y:.5*-o.height};break;case b.BottomRight:n={x:-o.width,y:-o.height};break;case b.BottomLeft:n={x:0,y:-o.height};break;case b.TopRight:n={x:-o.width,y:0};break;case b.TopLeft:n={x:0,y:0};break;case b.Center:n={x:.5*-o.width,y:.5*-o.height}}var s=this.pony.topLeftRect();switch(i){case b.Top:n.x+=s.x+.5*s.width,n.y+=s.y;break;case b.Bottom:n.x+=s.x+.5*s.width,n.y+=s.y+s.height;break;case b.Left:n.x+=s.x,n.y+=s.y+.5*s.height;break;case b.Right:n.x+=s.x+s.width,n.y+=s.y+.5*s.height;break;case b.BottomRight:n.x+=s.x+s.width,n.y+=s.y+s.height;break;case b.BottomLeft:n.x+=s.x,n.y+=s.y+s.height;break;case b.TopRight:n.x+=s.x+s.width,n.y+=s.y;break;case b.TopLeft:n.x+=s.x,n.y+=s.y;break;case b.Center:n.x+=s.x+.5*s.width,n.y+=s.y+.5*s.height}this.setTopLeftPosition(n)},setImage:d?function(e){var t;this.current_imgurl!==e&&((t=this.createImage(e)).style.left=this.img.style.left,t.style.top=this.img.style.top,t.style.zIndex=this.img.style.zIndex,this.current_imgurl=e,this.img.parentNode.replaceChild(t,this.img),this.img=t)}:function(e){this.current_imgurl!==e&&(this.img.src=this.current_imgurl=e,this.img.style.width=this.current_size.width+"px",this.img.style.height=this.current_size.height+"px")},update:function(e,t,i){var n;return this.effect.follow&&(this.updatePosition(e,t),this.pony.facing_right?(n=this.effect.rightimage,this.current_size=this.effect.rightsize,this.current_center=this.effect.rightcenter_point):(n=this.effect.leftimage,this.current_size=this.effect.leftsize,this.current_center=this.effect.leftcenter_point),this.setImage(n)),!this.effect.duration||e<this.end_time}});var ee=Date.now(),te=function(){if(null!==ve){for(var e=Date.now(),t=e-ee,i=_(),n=0,r=de.length;n<r;++n)de[n].update(e,t,i);for(var o,n=0;n<ge.length;){var s=ge[n];s.at+ie<=e?(s.element.parentNode&&s.element.parentNode.removeChild(s.element),ge.splice(n,1)):(s.at<=e&&v(s.element,1-(e-s.at)/ie),++n)}se&&(we||(o=xe(),we=a("div",{style:{fontSize:"18px",position:"fixed",bottom:"0",left:"0",zIndex:String(9001+c)}}),o.appendChild(we)),we.innerHTML=Math.round(1e3/t)+" fps"),ve=setTimeout(te,Math.max(ue-(e-Date.now()),0)),ee=e}},ie=500,ne=!1,re=!0,oe=!1,se=!1,ae=f.abs(""),he=3,le=.1,ce=!1,ue=40,pe=500,fe={},de=[],ge=[],me=null,ve=null,be=null,ye=null,we=null,_e=1,xe=function(){return(me=me||a("div",{id:"browser-ponies"})).parentNode||document.body.appendChild(me),me};return l(document,"touchstart",function(e){be=null}),l(document,"mousemove",function(e){be=be||{x:e.clientX,y:e.clientY},ye&&(ye.moveBy({x:e.clientX-be.x,y:e.clientY-be.y}),w(ye.dest_position,ye.current_position),e.preventDefault()),be.x=e.clientX,be.y=e.clientY}),l(document,"mouseup",function(){var e;ye&&(e=ye,(ye=null)!==ve&&e.nextBehavior())}),{convertPony:function(e,t){for(var i=R.parse(e),n={baseurl:t||"",behaviorgroups:{},behaviors:[],speeches:[],categories:[]},r={},o=[],s=0,a=i.length;s<a;++s){var h,l=i[s];switch(l[0].toLowerCase()){case"name":n.name=l[1];break;case"behaviorgroup":var c=parseInt(l[1],10);isNaN(c)?console.warn(t+": illegal behavior group id: ",l[1]):n.behaviorgroups[c]=l[2];break;case"behavior":var u={name:l[1],probability:Number(l[2]),maxduration:Number(l[3]),minduration:Number(l[4]),speed:Number(l[5]),rightimage:encodeURIComponent(l[6]),leftimage:encodeURIComponent(l[7]),movement:l[8],effects:[],auto_select_images:!0,dont_repeat_animation:!1};9<l.length&&(l[9]&&(u.linked=l[9]),(c=(l[10]||"").trim())&&(u.speakstart=c),(c=(l[11]||"").trim())&&(u.speakend=c),u.skip=L(l[12]),u.x=Number(l[13]),u.y=Number(l[14]),l[15]&&(u.follow=l[15]),16<l.length&&(u.auto_select_images=L(l[16]),l[17]&&(u.stopped=l[17]),l[18]&&(u.moving=l[18]),19<l.length&&(u.rightcenter=z(l[19]),u.leftcenter=z(l[20]),21<l.length&&(u.dont_repeat_animation=L(l[21]),u.dont_repeat_animation&&console.warn(t+": behavior "+u.name+" sets dont_repeat_animation to true, which is not supported by Browser Ponies due to limitations in browsers. Please use a GIF that does not loop instead."),l[22]&&(u.group=parseInt(l[22],10),isNaN(u.group)&&(delete u.group,console.warn(t+": behavior "+u.name+" references illegal behavior group id: ",l[22]))))))),n.behaviors.push(u),r[u.name.toLowerCase()]=u;break;case"effect":(v={name:l[1],behavior:l[2],rightimage:encodeURIComponent(l[3]),leftimage:encodeURIComponent(l[4]),duration:Number(l[5]),delay:Number(l[6]),rightloc:l[7].trim(),rightcenter:l[8].trim(),leftloc:l[9].trim(),leftcenter:l[10].trim(),follow:L(l[11]),dont_repeat_animation:!!l[12]&&L(l[12])}).dont_repeat_animation&&console.warn(t+": effect "+v.name+" sets dont_repeat_animation to true, which is not supported by Browser Ponies due to limitations in browsers. Please use a GIF that does not loop instead."),o.push(v);break;case"speak":if(2===l.length)h={text:l[1]};else{h={name:l[1],text:l[2].trim()},l[4]&&(h.skip=L(l[4])),l[5]&&(h.group=parseInt(l[5],10));var p=l[3];if(p&&(Array.isArray(p)||(p=[p]),0<p.length)){h.files={};for(var f=0;f<p.length;++f){var d=p[f],g=/(?:\.([^\.]*))?$/.exec(d)[1],g=g?(g=g.toLowerCase(),P[g]||"audio/x-"+g):"audio/x-unknown";g in h.files&&console.warn(t+": file type "+g+" of speak line "+h.name+" is not unique."),h.files[g]=encodeURIComponent(d)}}"group"in h&&isNaN(h.group)&&(delete h.group,console.warn(t+": speak line "+h.name+" references illegal behavior group id: ",l[5]))}n.speeches.push(h);break;case"categories":n.categories=n.categories.concat(l.slice(1));break;default:console.warn(t+": Unknown pony setting:",l)}}if(!("name"in n))throw new Error("Pony with following base URL has no name: "+n.baseurl);for(var m,s=0,a=o.length;s<a;++s){var v,u=(v=o[s]).behavior.toLowerCase();x(r,u)?(r[u].effects.push(v),delete v.behavior):console.warn(t+": Effect "+v.name+" of pony "+n.name+" references non-existing behavior "+v.behavior)}for(m in r)0===(u=r[m]).effects.length&&delete u.effects;var b,y=!1;for(b in n.behaviorgroups){y=!0;break}return y||delete n.behaviorgroups,n},convertInteractions:function(e){for(var t=R.parse(e),i=[],n=0,r=t.length;n<r;++n){var o=t[n],s="one";if(4<o.length)if("true"===(s=o[5].trim().toLowerCase())||"all"===s)s="all";else if("random"==s||"any"===s)s="any";else{if("false"!==s&&"one"!==s)throw new Error("illegal target activation value: "+o[5]);s="one"}var a=o[3].trim().toLowerCase();"default"!==a&&(a=Number(a)),i.push({name:o[0],pony:o[1],probability:Number(o[2]),proximity:a,targets:o[4],activate:s,behaviors:o[6],delay:7<o.length?Number(o[7].trim()):0})}return i},addInteractions:function(e){"string"==typeof e&&(e=this.convertInteractions(e));for(var t=0,i=e.length;t<i;++t)this.addInteraction(e[t])},addInteraction:function(e){var t=e.pony.toLowerCase();return x(fe,t)?fe[t].addInteraction(e):(console.error("No such pony:",e.pony),!1)},addPonies:function(e){for(var t=0,i=e.length;t<i;++t)this.addPony(e[t])},addPony:function(e){if(e.ini&&(e=this.convertPony(e.ini,e.baseurl)),0===e.behaviors.length)return console.error("Pony "+e.name+" has no behaviors."),!1;var t=e.name.toLowerCase();return x(fe,t)?(console.error("Pony "+e.name+" already exists."),!1):(fe[t]=new K(e),!0)},removePonies:function(e){for(var t=0,i=e.length;t<i;++t)this.removePony(e[t])},removePony:function(e){e=e.toLowerCase();x(fe,e)&&(fe[e].unspawnAll(),delete fe[e])},spawnRandom:function(e){if(e=void 0===e?1:parseInt(e),isNaN(e))return console.error("unexpected NaN value"),[];for(var t=[];0<e;){var i=1/0;for(o in fe){var n=fe[o].instances.length;n<i&&(i=n)}if(i===1/0){console.error("can't spawn random ponies because there are no ponies loaded");break}var r=[];for(o in fe)fe[o].instances.length===i&&r.push(o);var o=M(r);this.spawn(o)&&t.push(o),--e}return t},spawn:function(e,t){var i=e.toLowerCase();if(!x(fe,i))return console.error("No such pony:",e),!1;var n=fe[i];if(void 0===t)t=1;else if(t=parseInt(t),isNaN(t))return console.error("unexpected NaN value"),!1;0<t&&null!==ve&&n.preload();for(var r=t;0<r;){var o=new Z(n);n.instances.push(o),null!==ve?V(function(){-1!==this.pony.instances.indexOf(this)&&(de.push(this),this.img.style.visibility="hidden",xe().appendChild(this.img),this.teleport(),this.nextBehavior(),this.clipToScreen(),this.img.style.visibility="")}.bind(o)):de.push(o),--r}return!0},unspawn:function(e,t){var i=e.toLowerCase();if(!x(fe,i))return console.error("No such pony:",e),!1;var n=fe[i];if(void 0===t)t=n.instances.length;else if(t=parseInt(t),isNaN(t))return console.error("unexpected NaN value"),!1;if(t>=n.instances.length)n.unspawnAll();else for(;0<t;)n.instances[n.instances.length-1].unspawn(),--t;return!0},unspawnAll:function(){for(var e in fe)fe[e].unspawnAll()},clear:function(){this.unspawnAll(),fe={}},preloadAll:function(){for(var e in fe)fe[e].preload()},preloadSpawned:function(){for(var e in fe){var t=fe[e];0<t.instances.length&&t.preload()}},start:function(){ne?this.preloadAll():this.preloadSpawned(),V(function(){var e=xe();e.innerHTML="";for(var t=0,i=de.length;t<i;++t){var n=de[t];n.clear(),n.img.style.visibility="hidden",e.appendChild(n.img),n.teleport(),n.nextBehavior(),n.clipToScreen(),n.img.style.visibility=""}null===ve&&(ee=Date.now(),ve=setTimeout(te,0))})},timer:function(){return ve},stop:function(){me&&(me.parentNode.removeChild(me),me.innerHTML="",me=null),(we=null)!==ve&&(clearTimeout(ve),ve=null)},pause:function(){null!==ve&&(clearTimeout(ve),ve=null)},resume:function(){ne?this.preloadAll():this.preloadSpawned(),V(function(){null===ve&&(ee=Date.now(),ve=setTimeout(te,0))})},setInterval:function(e){e=parseInt(e),isNaN(e)?console.error("unexpected NaN value for interval"):ue!==e&&(ue=e)},getInterval:function(){return ue},setFps:function(e){this.setInterval(1e3/Number(e))},getFps:function(){return 1e3/ue},setInteractionInterval:function(e){e=Number(e),isNaN(e)?console.error("unexpected NaN value for interaction interval"):pe=e},getInteractionInterval:function(){return pe},setSpeakProbability:function(e){e=Number(e),isNaN(e)?console.error("unexpected NaN value for speak probability"):le=e},getSpeakProbability:function(){return le},setDontSpeak:function(e){ce=!!e},isDontSpeak:function(){return ce},setVolume:function(e){e=Number(e),isNaN(e)?console.error("unexpected NaN value for volume"):e<0||1<e?console.error("volume out of range",e):_e=e},getVolume:function(){return _e},setBaseUrl:function(e){ae=f.fix(e)},getBaseUrl:function(){return ae},setSpeed:function(e){he=Number(e)},getSpeed:function(){return he},setAudioEnabled:function(t){if("string"==typeof t)try{t=L(t)}catch(e){return void console.error("illegal value for audio enabled",t,e)}else t=!!t;oe!==t&&t?(oe=t,ne?this.preloadAll():this.preloadSpawned()):oe=t},isAudioEnabled:function(){return oe},setShowFps:function(t){if("string"==typeof t)try{se=L(t)}catch(e){return void console.error("illegal value for show fps",t,e)}else se=!!t;!se&&we&&(we.parentNode&&we.parentNode.removeChild(we),we=null)},isShowFps:function(){return se},setPreloadAll:function(t){if("string"==typeof t)try{ne=L(t)}catch(e){return void console.error("illegal value for preload all",t,e)}else ne=!!t},isPreloadAll:function(){return ne},setShowLoadProgress:function(e){if("string"==typeof e)try{re=L(e)}catch(e){return void console.error(e)}else re=!!e},isShowLoadProgress:function(){return re},getFadeDuration:function(){return ie},setFadeDuration:function(e){ie=Number(e)},running:function(){return null!==ve},ponies:function(){return fe},loadConfig:function(e){if("baseurl"in e&&this.setBaseUrl(e.baseurl),"speed"in e&&this.setSpeed(e.speed),"speakProbability"in e&&this.setSpeakProbability(e.speakProbability),"dontSpeak"in e&&this.setDontSpeak(e.dontSpeak),"volume"in e&&this.setVolume(e.volume),"interval"in e&&this.setInterval(e.interval),"fps"in e&&this.setFps(e.fps),"interactionInterval"in e&&this.setInteractionInterval(e.interactionInterval),"audioEnabled"in e&&this.setAudioEnabled(e.audioEnabled),"showFps"in e&&this.setShowFps(e.showFps),"preloadAll"in e&&this.setPreloadAll(e.preloadAll),"showLoadProgress"in e&&this.setShowLoadProgress(e.showLoadProgress),"fadeDuration"in e&&this.setFadeDuration(e.fadeDuration),e.ponies&&this.addPonies(e.ponies),e.interactions&&this.addInteractions(e.interactions),e.spawn)for(var t in e.spawn)this.spawn(t,e.spawn[t]);if("spawnRandom"in e&&this.spawnRandom(e.spawnRandom),e.onload)if(Array.isArray(e.onload))for(var i=0,n=e.onload.length;i<n;++i)V(e.onload[i]);else V(e.onload);e.autostart&&null===ve&&this.start()},dumpConfig:function(){var e,t={};for(e in t.baseurl=this.getBaseUrl(),t.speed=this.getSpeed(),t.speakProbability=this.getSpeakProbability(),t.dontSpeak=this.isDontSpeak(),t.volume=this.getVolume(),t.interval=this.getInterval(),t.fps=this.getFps(),t.interactionInterval=this.getInteractionInterval(),t.audioEnabled=this.isAudioEnabled(),t.showFps=this.isShowFps(),t.preloadAll=this.isPreloadAll(),t.showLoadProgress=this.isShowLoadProgress(),t.fadeDuration=this.getFadeDuration(),t.spawn={},fe){var i=fe[e];0<i.instances.length&&(t.spawn[i.name]=i.instances.length)}return t},togglePoniesToBackground:function(){if("undefined"==typeof toggleBrowserPoniesToBackground)alert("This website does not support bringing Browser Ponies to the background.");else try{toggleBrowserPoniesToBackground()}catch(e){alert("Error toggling Browser Ponies to the background:\n\n"+e.name+": "+e.message)}},Util:{setOpacity:v,extend:w,tag:w(a,{add:m}),has:x,format:p,partial:u,observe:l,stopObserving:s,IE:o,Opera:t,Gecko:d,HasAudio:g,BaseZIndex:c,onload:V,onprogress:W,$:function(e){return"string"==typeof e?document.getElementById(e):e&&1===e.nodeType?e:null},randomSelect:M,dataUrl:function(e,t){return"data:"+e+";base64,"+r.encode(t)},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},Base64:r,PonyINI:R,getOverlay:xe,parseBoolean:L,parsePoint:z,URL:f}}}(),"undefined"!=typeof BrowserPoniesConfig&&(BrowserPonies.loadConfig(BrowserPoniesConfig),BrowserPoniesConfig.oninit&&function(){if(Array.isArray(BrowserPoniesConfig.oninit))for(var e=0,t=BrowserPoniesConfig.oninit.length;e<t;++e)BrowserPoniesConfig.oninit[e]();else BrowserPoniesConfig.oninit()}()));